<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist! - Login!</title>
    <link rel="shortcut icon" href="./img/logo-watchlist.png" />
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/main-menu.css">
    <link rel="stylesheet" href="./css/box.css">
    <script src="./js/login-auth.js"></script>
</head>
<body style="background-image: url('./img/login-background.jpg'); background-repeat: no-repeat; background-size: cover;">

    <!-- start menu -->
    <header class="main-menu-box" id="idMenuBox">
        
    </header>
    <!-- end menu -->

    <!-- input box -->
    <div class="login-box center" id="idLoginBox" action="POST" >
        <form class="box-container st center-column-child" id="form_login" onsubmit="login()">
            <input id="idEmail" placeholder="E-mail" class="login-box-input" type="email" name="email" required> 
            <input id="idPwd" placeholder="Senha" class="login-box-input" type="password" name="pwd" required>

            <button type="submit" class="login-box-button" value="Entrar">Entrar</button> 
        </form>
    </div>
    <!-- end input box -->

</body>
</html>
<script src="./js/build-menu.js"></script>
<script>

    // function login() {
    //     const email = idEmail.value;
    //     const pwd = idPwd.value;

    //     if (authLogin(email, pwd)) {
    //         alert("logou");
    //         window.location.href = "";
    //     } else {
    //         alert("nÃ£o logou");
    //     }
    // }

    function login() {
        // armazenando valores dos inputs
        const email = idEmail.value;
        const pwd = idPwd.value;

        fetch(`/users/autenticar?email=${email}&pwd=${pwd}`, {
            method: "GET",
            // body: form
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json);
                    console.log(json[0]);
                    
                    if (json.length == 0) {
                        console.log("erro de login");
                    } else {
                        let user = JSON.stringify(json[0]);

                        localStorage.setItem("watchlist_user", user);
                        window.location.href = './index.html';
                    }
                });

            } else {

                console.log('Erro de login!');
                
            }
        });

        return false;
    }

</script>