<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist! - Obra</title>
    <link rel="shortcut icon" href="./img/logo-watchlist.png" />
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/main-menu.css">
    <link rel="stylesheet" href="./css/box.css">
</head>
<body>
    
    <!-- start menu -->
    <header class="main-menu-box" id="idMenuBox">
        
    </header>
    <!-- end menu -->

    <div class="media-box">
        <div>
            <img class="title-post" id="titleImg">
            <div class="title-info">
                <p>Tipo: <span id="titleType"></span></p>
                <p>Genero: <span id="titleGenre"></span></p>
                <p>Ano: <span id="titleYear"></span></p>
            </div>
        </div>
        <div class="title-text-box">
            <h1 class="title-text-title" id="titleTitle">Fumetsu no Anata E </h1>
            <p id="titleTextSynopsis">

            </p>
        </div>

        <!-- score box -->
        <div class="right-box">
            <div class="score-box">
                <div class="score-box-text">
                    Score: <br>
                    <span id="scoreValue">8.6</span> / 10
                </div>
            </div>

            <form class="form-user-has-media">
                <div class="form-input-box">
                    Episódios:
                    <input id="idEpValue" type="number" min="0" value="0"> / <span id="idMaxEp"></span>
                    <div id="titleMaxEp"> + </div>
                </div>

                <div class="form-input-box">
                    Situação:
                    <select name="situation" id="idTitleSituation" required>
                        <option disabled selected value>Selecione uma opção</option>
                        <option value="0">Assistindo</option>
                        <option value="1">Planejo Assistir</option>
                        <option value="2">Completo</option>
                        <option value="3">Nao vejo mais</option>
                    </select>
                </div>

                <div class="form-input-box">
                    Nota: 
                    <select name="score" id="idScore" required>
                        <option disabled selected value>Escolha</option>
                        <option value="10">Obra de Arte (10)</option>
                        <option value="9">Ótimo (9)</option>
                        <option value="8">Muito Bom (8)</option>
                        <option value="7">Bom (7)</option>
                        <option value="6">Legal (6)</option>
                        <option value="5">Médio (5)</option>
                        <option value="4">Ruim (4)</option>
                        <option value="3">Muito Ruim (3)</option>
                        <option value="2">Horrivel (2)</option>
                        <option value="1">Apavorante (1)</option>
                    </select>
                </div>

                <input type="submit" value="Atualizar" class="btn btn-green">
            </form>
        </div>
        <!-- end score box -->
    </div>
</body>
</html>
<script src="./js/build-menu.js"></script>

<script>

    function add1_ep(max) {
        let eps = idEpValue.value;

        if (eps < max) {
            idEpValue.value = ++eps;
        }
    }

    // preenchendo parte dinamica do site
    fetch(`/leituras/media/1`)
    .then(function (response) {
        if (response.ok) {
            response.json().then(function (dadosMedia) {
                // tratamento dos dados
                let data = dadosMedia[0];
                console.log(data);

                titleType.innerHTML = data.type;
                titleGenre.innerHTML = data.genre_name;
                titleYear.innerHTML = data.since_year;
                titleImg.setAttribute("src", data.banner_url);
                titleTitle.innerHTML = data.title;
                titleTextSynopsis.innerHTML = data.synopsis;
                idMaxEp.innerHTML = data.total_eps;
                idEpValue.setAttribute("max", data.total_eps);
                titleMaxEp.setAttribute("onclick", `add1_ep(${data.total_eps})`);
            })
        }
    })
    .catch(function (error) {
        console.log("error: ", error.message);
    });
    
</script>